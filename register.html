<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registrazione FitLife</title>
<link rel="icon" type="image/x-icon" href="/img/logo.png">
<style>
/* --- STILI GENERALI --- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: url('https://images.unsplash.com/photo-1579758629938-03607ccdbaba?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
  background-size: cover;
  position: relative;
  color: #fff;
  margin: 0;
  padding: 20px;
}

/* Overlay scuro sullo sfondo */
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: -1;
}

/* Pulsante Home */
.home-btn {
  position: absolute;
  top: 20px;
  left: 20px;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  font-size: 15px;
  color: white;
  background: linear-gradient(135deg, #800020 0%, #000000 100%);
  transition: all 0.4s ease;
  z-index: 1000;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}
.home-btn:hover {
  background: linear-gradient(135deg, #000000 0%, #800020 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(128, 0, 32, 0.5);
}

/* --- CONTENITORE PRINCIPALE --- */
.container {
  display: flex;
  gap: 40px;
  justify-content: center;
  align-items: flex-start;
  padding: 30px;
  max-width: 1400px;
  width: 100%;
  transition: all 0.5s ease;
  position: relative;
  z-index: 1;
}

/* --- SEZIONE FORM (SINISTRA) --- */
.form-section {
  width: 420px;
  flex-shrink: 0;
}

/* Form stile login */
.form-section .form {
  width: 100%;
  border-radius: 15px;
  padding: 35px 40px;
  text-align: center;
  backdrop-filter: blur(12px);
  border: 2px solid rgba(128, 0, 32, 0.3);
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.2) 0%, rgba(10, 10, 10, 0.8) 100%);
  color: #ffffff;
  box-shadow: 0 10px 30px rgba(128, 0, 32, 0.2);
}

.title {
  font-size: 38px;
  margin-bottom: 20px;
  color: #fff;
  font-weight: 800;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.message {
  font-size: 15px;
  color: rgba(255, 255, 255, 0.9);
  text-align: center;
  margin-bottom: 25px;
  line-height: 1.5;
}

.signin {
  font-size: 14.5px;
  color: rgba(255, 255, 255, 0.9);
  text-align: center;
  margin-top: 25px;
}

.signin a {
  color: #ff4d6d;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.3s ease;
}

.signin a:hover {
  color: #ff8fa3;
  text-decoration: underline;
}

.flex {
  display: flex;
  width: 100%;
  gap: 12px;
}

.form label {
  position: relative;
  flex: 1;
  margin-bottom: 20px;
}

.form label .input {
  width: 100%;
  height: 52px;
  background: rgba(10, 10, 10, 0.6);
  border: none;
  outline: none;
  border: 2px solid rgba(128, 0, 32, 0.4);
  border-radius: 12px;
  font-size: 16px;
  color: #fff;
  padding: 20px 45px 20px 20px;
  margin: 12px 0;
  transition: all 0.3s ease;
  font-weight: 500;
}

.form label .input:focus {
  border-color: #800020;
  box-shadow: 0 0 15px rgba(128, 0, 32, 0.3);
  background: rgba(10, 10, 10, 0.8);
}

.form label .input + span {
  color: rgba(255, 255, 255, 0.9);
  position: absolute;
  left: 20px;
  top: -10px;
  font-size: 0.8em;
  background: linear-gradient(135deg, #800020 0%, #000000 100%);
  padding: 2px 8px;
  transition: 0.3s ease;
  border-radius: 4px;
  font-weight: 600;
}

.form label .input:placeholder-shown + span {
  top: 22px;
  font-size: 0.9em;
  background: transparent;
  color: rgba(255, 255, 255, 0.6);
}

.form label .input:focus + span,
.form label .input:valid + span {
  color: #fff;
  top: -10px;
  font-size: 0.75em;
  font-weight: 700;
  background: linear-gradient(135deg, #800020 0%, #000000 100%);
}

.password-container {
  position: relative;
  width: 100%;
}

.toggle-password {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #800020;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: color 0.3s ease;
}

.toggle-password:hover {
  color: #ff4d6d;
}

/* --- SEZIONE PIANI (DESTRA) --- */
.plans-section {
  flex: 1;
  display: none;
  flex-direction: column;
  gap: 25px;
  max-width: 800px;
}

/* Griglia 5 box */
.plans-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 25px;
  width: 100%;
}

.plan {
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.15) 0%, rgba(10, 10, 10, 0.8) 100%);
  padding: 28px;
  border-radius: 15px;
  text-align: center;
  transition: all 0.4s ease;
  border: 2px solid rgba(128, 0, 32, 0.2);
  backdrop-filter: blur(12px);
  min-height: 220px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.plan:hover {
  border-color: #800020;
  transform: translateY(-8px);
  box-shadow: 0 15px 35px rgba(128, 0, 32, 0.3);
}

.plan.selected {
  border-color: #800020;
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.3) 0%, rgba(10, 10, 10, 0.9) 100%);
  transform: scale(1.05);
  box-shadow: 0 12px 30px rgba(128, 0, 32, 0.4);
}

.plan h3 {
  margin-bottom: 18px;
  color: #fff;
  font-size: 1.5em;
  font-weight: 800;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.plan p {
  margin-bottom: 12px;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.5;
  font-weight: 500;
}

.plan strong {
  font-size: 1.4em;
  color: #fff;
  display: block;
  margin: 15px 0;
  font-weight: 800;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.choosePlan {
  margin-top: 18px;
  padding: 14px 28px;
  background: linear-gradient(135deg, #800020 0%, #5a0017 100%);
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 12px;
  transition: all 0.3s ease;
  font-weight: 700;
  font-size: 15px;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}

.choosePlan:hover {
  background: linear-gradient(135deg, #5a0017 0%, #800020 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(128, 0, 32, 0.5);
}

/* PIANO SELEZIONATO */
.selected-plan-container {
  display: none;
  flex-direction: column;
  gap: 25px;
  width: 100%;
}

.selected-plan {
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.25) 0%, rgba(10, 10, 10, 0.85) 100%);
  border: 2px solid rgba(128, 0, 32, 0.4);
  border-radius: 15px;
  padding: 35px;
  text-align: center;
  backdrop-filter: blur(12px);
  box-shadow: 0 10px 30px rgba(128, 0, 32, 0.2);
}

.selected-plan h3 {
  color: #fff;
  margin-bottom: 18px;
  font-size: 2em;
  font-weight: 800;
}

.selected-plan p {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 12px;
  font-size: 1.15em;
  font-weight: 500;
}

.selected-plan strong {
  font-size: 1.8em;
  color: #fff;
  font-weight: 800;
}

/* --- PULSANTI DI PAGAMENTO --- */
#paymentButtons {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
}

#goPayment, #reviewPlans {
  padding: 16px 28px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  display: none;
  font-weight: 700;
  transition: all 0.3s ease;
  width: 100%;
  font-size: 16px;
}

#goPayment {
  background: linear-gradient(135deg, #800020 0%, #5a0017 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}

#goPayment:hover {
  background: linear-gradient(135deg, #5a0017 0%, #800020 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(128, 0, 32, 0.5);
}

#reviewPlans {
  background: linear-gradient(135deg, #333 0%, #000 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

#reviewPlans:hover {
  background: linear-gradient(135deg, #000 0%, #333 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

/* --- CARTA DI CREDITO INTERATTIVA --- */
.card-container {
  perspective: 1000px;
  width: 340px;
  height: 210px;
  margin: 0 auto 35px;
}

.card {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.6s ease;
}

.card.flipped {
  transform: rotateY(180deg);
}

.card-front, .card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 10px 30px rgba(128, 0, 32, 0.3);
  backdrop-filter: blur(8px);
}

.card-front {
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.9) 0%, rgba(0, 0, 0, 0.9) 100%);
  border: 2px solid rgba(128, 0, 32, 0.6);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.card-back {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(128, 0, 32, 0.9) 100%);
  border: 2px solid rgba(128, 0, 32, 0.6);
  transform: rotateY(180deg);
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.card-number {
  font-size: 19px;
  letter-spacing: 2px;
  margin: 12px 0;
  font-family: 'Courier New', monospace;
  cursor: pointer;
  padding: 8px;
  border-radius: 6px;
  transition: background-color 0.3s ease;
  color: #fff;
  font-weight: 600;
}

.card-number.editing {
  background-color: rgba(128, 0, 32, 0.3);
  border: 2px dashed #800020;
}

.card-details {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
}

.card-holder, .card-expiry {
  display: flex;
  flex-direction: column;
  cursor: pointer;
  padding: 6px;
  border-radius: 6px;
  transition: background-color 0.3s ease;
}

.card-holder.editing, .card-expiry.editing {
  background-color: rgba(128, 0, 32, 0.3);
  border: 2px dashed #800020;
}

.card-label {
  font-size: 10px;
  color: #ffb3c1;
  margin-bottom: 6px;
  font-weight: 600;
}

.card-value {
  font-size: 16px;
  color: #fff;
  font-weight: 600;
}

.card-stripe {
  background: #000;
  height: 45px;
  margin-bottom: 25px;
  border: 2px solid #800020;
}

.card-cvv-container {
  cursor: pointer;
  padding: 6px;
  border-radius: 6px;
  transition: background-color 0.3s ease;
  margin: 0 25px;
}

.card-cvv-container.editing {
  background-color: rgba(128, 0, 32, 0.3);
  border: 2px dashed #800020;
}

.card-cvv-label {
  font-size: 10px;
  color: #ffb3c1;
  margin-bottom: 6px;
  font-weight: 600;
}

.card-cvv {
  background: #fff;
  color: #000;
  padding: 8px 12px;
  border-radius: 5px;
  text-align: right;
  font-family: 'Courier New', monospace;
  font-size: 16px;
  min-height: 35px;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  font-weight: 600;
  border: 1px solid #800020;
}

/* --- PULSANTE PER GIRARE LA CARTA --- */
.flip-card-btn {
  background: linear-gradient(135deg, #800020 0%, #5a0017 100%);
  color: white;
  border: none;
  padding: 12px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  margin-bottom: 20px;
  transition: all 0.3s ease;
  font-weight: 600;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}

.flip-card-btn:hover {
  background: linear-gradient(135deg, #5a0017 0%, #800020 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(128, 0, 32, 0.4);
}

/* --- INPUT OVERLAY PER SCRITTURA DIRETTA --- */
.card-input-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10;
  border-radius: 15px;
}

.card-input-container {
  background: linear-gradient(135deg, #800020 0%, #000000 100%);
  padding: 25px;
  border-radius: 12px;
  width: 85%;
  max-width: 320px;
  border: 2px solid #800020;
  box-shadow: 0 0 30px rgba(128, 0, 32, 0.6);
}

.card-input-container h3 {
  color: #fff;
  margin-bottom: 18px;
  text-align: center;
  font-weight: 700;
  font-size: 1.3em;
}

.card-input {
  width: 100%;
  padding: 14px;
  background: rgba(10, 10, 10, 0.8);
  color: #fff;
  border: 2px solid #800020;
  border-radius: 8px;
  font-size: 16px;
  margin-bottom: 18px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.card-input:focus {
  border-color: #ff4d6d;
  box-shadow: 0 0 15px rgba(128, 0, 32, 0.5);
  background: rgba(10, 10, 10, 0.9);
}

.card-input-buttons {
  display: flex;
  gap: 12px;
}

.card-input-confirm, .card-input-cancel {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  transition: all 0.3s ease;
}

.card-input-confirm {
  background: linear-gradient(135deg, #800020 0%, #5a0017 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}

.card-input-confirm:hover {
  background: linear-gradient(135deg, #5a0017 0%, #800020 100%);
  transform: scale(1.05);
}

.card-input-cancel {
  background: linear-gradient(135deg, #333 0%, #000 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.card-input-cancel:hover {
  background: linear-gradient(135deg, #000 0%, #333 100%);
  transform: scale(1.05);
}

/* --- PAGINA DI PAGAMENTO --- */
.payment-page {
  display: none;
  width: 520px;
  border-radius: 15px;
  padding: 35px 45px;
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.2) 0%, rgba(10, 10, 10, 0.8) 100%);
  border: 2px solid rgba(128, 0, 32, 0.3);
  box-shadow: 0 15px 35px rgba(128, 0, 32, 0.25);
  text-align: center;
  backdrop-filter: blur(12px);
  color: #ffffff;
}

.payment-page h2 {
  color: #fff;
  margin-bottom: 25px;
  font-size: 2.2em;
  font-weight: 800;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.payment-details {
  background: rgba(128, 0, 32, 0.15);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 25px;
  text-align: left;
  border: 1px solid rgba(128, 0, 32, 0.3);
}

.payment-details h3 {
  color: #fff;
  margin-bottom: 12px;
  font-size: 1.4em;
  font-weight: 700;
}

.payment-instructions {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 25px;
  font-size: 15px;
  text-align: center;
  line-height: 1.5;
  font-weight: 500;
}

#confirmPayment {
  background: linear-gradient(135deg, #800020 0%, #5a0017 100%);
  color: white;
  padding: 16px;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 15px;
  transition: all 0.3s ease;
  width: 100%;
  font-size: 16px;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}

#confirmPayment:hover {
  background: linear-gradient(135deg, #5a0017 0%, #800020 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(128, 0, 32, 0.5);
}

#backToPlans {
  background: linear-gradient(135deg, #333 0%, #000 100%);
  color: white;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 12px;
  transition: all 0.3s ease;
  width: 100%;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

#backToPlans:hover {
  background: linear-gradient(135deg, #000 0%, #333 100%);
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

/* --- DASHBOARD PRINCIPALE --- */
.dashboard {
  display: none;
  width: 620px;
  border-radius: 15px;
  padding: 35px 45px;
  background: linear-gradient(135deg, rgba(128, 0, 32, 0.2) 0%, rgba(10, 10, 10, 0.8) 100%);
  border: 2px solid rgba(128, 0, 32, 0.3);
  box-shadow: 0 15px 35px rgba(128, 0, 32, 0.25);
  text-align: center;
  backdrop-filter: blur(12px);
  color: #ffffff;
}

.dashboard h2 {
  color: #fff;
  margin-bottom: 25px;
  font-size: 2.2em;
  font-weight: 800;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.user-info {
  background: rgba(128, 0, 32, 0.15);
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 25px;
  text-align: left;
  border: 1px solid rgba(128, 0, 32, 0.3);
}

.user-info h3 {
  color: #fff;
  margin-bottom: 18px;
  font-size: 1.3em;
  font-weight: 700;
}

.plan-status {
  background: rgba(128, 0, 32, 0.15);
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 25px;
  text-align: center;
  border: 1px solid rgba(128, 0, 32, 0.3);
}

.plan-status h3 {
  color: #fff;
  margin-bottom: 18px;
  font-size: 1.3em;
  font-weight: 700;
}

.days-remaining {
  font-size: 2.2em;
  color: #fff;
  font-weight: 800;
  margin: 15px 0;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.expiry-date {
  color: rgba(255, 255, 255, 0.9);
  font-size: 1.15em;
  font-weight: 500;
}

.dashboard-buttons {
  display: flex;
  gap: 12px;
  margin-top: 25px;
}

.dashboard-btn {
  flex: 1;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 15px;
}

.primary-btn {
  background: linear-gradient(135deg, #800020 0%, #5a0017 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(128, 0, 32, 0.3);
}

.secondary-btn {
  background: linear-gradient(135deg, #333 0%, #000 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.dashboard-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(128, 0, 32, 0.4);
}

.primary-btn:hover {
  background: linear-gradient(135deg, #5a0017 0%, #800020 100%);
}

.secondary-btn:hover {
  background: linear-gradient(135deg, #000 0%, #333 100%);
}

/* --- RESPONSIVE DESIGN --- */
@media (max-width: 1200px) {
  .container {
    flex-direction: column;
    align-items: center;
    gap: 35px;
  }
  
  .form-section {
    width: 100%;
    max-width: 520px;
  }
  
  .plans-section {
    width: 100%;
    max-width: 820px;
  }
}

@media (max-width: 900px) {
  .plans-container {
    grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
  }
}

@media (max-width: 500px) {
  .plans-container {
    grid-template-columns: 1fr;
  }
  
  .payment-page, .dashboard {
    width: 100%;
    max-width: 370px;
    padding: 25px;
  }
  
  .card-container {
    width: 300px;
    height: 185px;
  }
  
  .dashboard-buttons {
    flex-direction: column;
  }
  
  .flex {
    flex-direction: column;
  }
  
  .form-section .form {
    padding: 25px;
  }
  
  .container {
    padding: 20px;
  }
}

.error-message {
  color: #ff6b8b;
  font-size: 12px;
  margin-top: 6px;
  display: none;
  font-weight: 600;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}
</style>
</head>
<body>
<!-- Pulsante Home -->
<button class="home-btn" onclick="window.location.href='index.html'">Home</button>

<!-- CONTENITORE PRINCIPALE -->
<div class="container" id="mainContainer">
  <!-- SEZIONE FORM DI REGISTRAZIONE (SINISTRA) -->
  <div class="form-section" id="formSection">
    <form class="form" id="registrationForm">
        <p class="title">Register</p>
        <p class="message">Compila i dati per accedere ai piani.</p>
        <div class="flex">
            <label>
                <input class="input" type="text" placeholder="" required id="firstname">
                <span>Firstname</span>
                <div class="error-message" id="firstnameError"></div>
            </label>

            <label>
                <input class="input" type="text" placeholder="" required id="lastname">
                <span>Lastname</span>
                <div class="error-message" id="lastnameError"></div>
            </label>
        </div>  
                
        <label>
            <input class="input" type="email" placeholder="" required id="email">
            <span>Email</span>
            <div class="error-message" id="emailError"></div>
        </label> 
            
        <label>
            <div class="password-container">
                <input class="input" type="password" placeholder="" required id="password" minlength="6">
                <button type="button" class="toggle-password" id="togglePassword">Mostra</button>
            </div>
            <span>Password</span>
            <div class="error-message" id="passwordError"></div>
        </label>
        <label>
            <div class="password-container">
                <input class="input" type="password" placeholder="" required id="confirmPassword">
                <button type="button" class="toggle-password" id="toggleConfirmPassword">Mostra</button>
            </div>
            <span>Confirm password</span>
            <div class="error-message" id="confirmPasswordError"></div>
        </label>
        <button type="submit" class="choosePlan" style="width: 100%; margin-top: 25px;">Procedi alla Scelta del Piano</button>
        <p class="signin">Hai già un account? <a href="login.html">Accedi</a></p>
    </form>
  </div>

  <!-- SEZIONE PIANI (DESTRA) -->
  <div class="plans-section" id="plansSection">
    <!-- CONTENITORE PIANI -->
    <div class="plans-container" id="plansContainer">
      <!-- PIANO BASE -->
      <div class="plan" data-plan="Base" data-description="Accesso sala e attrezzature standard, Orario ridotto (6:00-22:00), Accesso a docce e spogliatoi" data-price="€29/mese">
        <h3>Base</h3>
        <p>Accesso sala e attrezzature standard</p>
        <p>Orario ridotto (6:00-22:00)</p>
        <p>Accesso a docce e spogliatoi</p>
        <strong>€29 / mese</strong>
        <button class="choosePlan">Scegli</button>
      </div>

      <!-- PIANO PRO -->
      <div class="plan" data-plan="Pro" data-description="Accesso completo a tutte le aree, Corsi di gruppo inclusi, Orario esteso (5:00-24:00)" data-price="€49/mese">
        <h3>Pro</h3>
        <p>Accesso completo a tutte le aree</p>
        <p>Corsi di gruppo inclusi</p>
        <p>Orario esteso (5:00-24:00)</p>
        <strong>€49 / mese</strong>
        <button class="choosePlan">Scegli</button>
      </div>

      <!-- PIANO PREMIUM -->
      <div class="plan" data-plan="Premium" data-description="Personal trainer incluso, Eventi esclusivi per membri, Accesso illimitato 24/7" data-price="€69/mese">
        <h3>Premium</h3>
        <p>Personal trainer incluso</p>
        <p>Eventi esclusivi per membri</p>
        <p>Accesso illimitato 24/7</p>
        <strong>€69 / mese</strong>
        <button class="choosePlan">Scegli</button>
      </div>

      <!-- PIANO POWER ANNUAL -->
      <div class="plan" data-plan="Power Annual" data-description="Tutti i benefici Premium, 2 mesi gratuiti, Check-up fitness trimestrale, Accesso area VIP" data-price="€599/anno">
        <h3>Power Annual</h3>
        <p>Tutti i benefici Premium</p>
        <p>2 mesi gratuiti</p>
        <p>Check-up fitness trimestrale</p>
        <p>Accesso area VIP</p>
        <strong>€599 / anno</strong>
        <div style="color: #ff6b8b; font-weight: bold; margin: 10px 0;">Risparmi €229!</div>
        <button class="choosePlan">Scegli</button>
      </div>

      <!-- PIANO ELITE ANNUAL -->
      <div class="plan" data-plan="Elite Annual" data-description="Servizio Premium completo, Nutrizionista incluso, Massaggio mensile, Ingresso per un ospite" data-price="€899/anno">
        <h3>Elite Annual</h3>
        <p>Servizio Premium completo</p>
        <p>Nutrizionista incluso</p>
        <p>Massaggio mensile</p>
        <p>Ingresso per un ospite</p>
        <strong>€899 / anno</strong>
        <div style="color: #ff6b8b; font-weight: bold; margin: 10px 0;">Risparmi €329!</div>
        <button class="choosePlan">Scegli</button>
      </div>
    </div>

    <!-- CONTENITORE PIANO SELEZIONATO -->
    <div class="selected-plan-container" id="selectedPlanContainer">
      <div class="selected-plan" id="selectedPlan">
        <h3 id="selectedPlanName">Base</h3>
        <p id="selectedPlanDescription">Accesso alla palestra</p>
        <p><strong id="selectedPlanPrice">€29/mese</strong></p>
      </div>

      <!-- PULSANTI PAGAMENTO -->
      <div id="paymentButtons">
        <button id="goPayment">Vai al pagamento</button>
        <button id="reviewPlans">Rivedi i piani</button>
      </div>
    </div>
  </div>
</div>

<!-- PAGINA DI PAGAMENTO -->
<div class="payment-page" id="paymentPage">
  <h2>Completa il Pagamento</h2>
  
  <div class="payment-details">
    <h3 id="paymentPlanName">Base</h3>
    <p id="paymentPlanDescription">Accesso alla palestra</p>
    <p><strong id="paymentPlanPrice">€29/mese</strong></p>
  </div>
  
  <p class="payment-instructions">Clicca sui campi della carta per inserire i dati</p>
  
  <!-- PULSANTE PER GIRARE LA CARTA -->
  <button class="flip-card-btn" id="flipCardBtn">Gira la carta per CVV</button>
  
  <!-- CARTA DI CREDITO INTERATTIVA -->
  <div class="card-container">
    <div class="card" id="creditCard">
      <!-- Fronte della carta -->
      <div class="card-front">
        <div class="card-number" id="card-number-display" data-field="card-number">•••• •••• •••• ••••</div>
        <div class="card-details">
          <div class="card-holder" data-field="card-holder">
            <div class="card-label">Titolare</div>
            <div class="card-value" id="card-holder-display">NOME COGNOME</div>
          </div>
          <div class="card-expiry" data-field="expiry-date">
            <div class="card-label">Scadenza</div>
            <div class="card-value" id="expiry-date-display">MM/AA</div>
          </div>
        </div>
      </div>
      
      <!-- Retro della carta -->
      <div class="card-back">
        <div class="card-stripe"></div>
        <div class="card-cvv-container" data-field="cvv">
          <div class="card-cvv-label">CVV</div>
          <div class="card-cvv" id="cvv-display">•••</div>
        </div>
      </div>
      
      <!-- Overlay per input -->
      <div class="card-input-overlay" id="cardInputOverlay">
        <div class="card-input-container">
          <h3 id="inputTitle">Inserisci Numero Carta</h3>
          <input type="text" class="card-input" id="cardInput" placeholder="">
          <div class="card-input-buttons">
            <button class="card-input-confirm" id="cardInputConfirm">Conferma</button>
            <button class="card-input-cancel" id="cardInputCancel">Annulla</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <button id="confirmPayment">Conferma Pagamento</button>
  <button id="backToPlans">Torna ai Piani</button>
</div>

<!-- DASHBOARD PRINCIPALE -->
<div class="dashboard" id="dashboard">
  <h2>Benvenuto in FitLife!</h2>
  
  <div class="user-info">
    <h3>I tuoi dati</h3>
    <p><strong>Nome:</strong> <span id="userName">-</span></p>
    <p><strong>Email:</strong> <span id="userEmail">-</span></p>
    <p><strong>Data registrazione:</strong> <span id="registrationDate">-</span></p>
  </div>
  
  <div class="plan-status">
    <h3>Il tuo piano</h3>
    <div id="userPlanName" style="font-size: 1.6em; color: #fff; margin-bottom: 12px; font-weight: 800;">-</div>
    <div id="userPlanDescription" style="color: #ccc; margin-bottom: 18px; font-weight: 500;">-</div>
    <div class="days-remaining" id="daysRemaining">-</div>
    <div class="expiry-date">Scadenza: <span id="planExpiryDate">-</span></div>
  </div>
  
  <div class="dashboard-buttons">
    <button class="dashboard-btn primary-btn" id="renewPlan">Rinnova Piano</button>
    <button class="dashboard-btn secondary-btn" id="changePlan">Cambia Piano</button>
    <button class="dashboard-btn secondary-btn" id="logoutBtn">Esci</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  // ✅ CONFIGURAZIONE FIREBASE CORRETTA
  const firebaseConfig = {
    apiKey: "AIzaSyDxbjc0jYzIBidTCA2lY0OtSioR8hz4bRs",
    authDomain: "akotb-palestra-b6f81.firebaseapp.com",
    projectId: "akotb-palestra-b6f81",
    storageBucket: "akotb-palestra-b6f81.firebasestorage.app",
    messagingSenderId: "1088603444773",
    appId: "1:1088603444773:web:de954e33936001a6d091cc"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  console.log("✅ Firebase connesso correttamente!");

  // --- VARIABILI GLOBALI ---
  let currentSelectedPlan = null;
  let currentEditingField = null;
  let userData = {};

  // Elementi DOM
  const elements = {
      mainContainer: document.getElementById("mainContainer"),
      formSection: document.getElementById("formSection"),
      plansSection: document.getElementById("plansSection"),
      plansContainer: document.getElementById("plansContainer"),
      chooseButtons: document.querySelectorAll(".choosePlan"),
      form: document.getElementById("registrationForm"),
      selectedPlanContainer: document.getElementById("selectedPlanContainer"),
      selectedPlanName: document.getElementById("selectedPlanName"),
      selectedPlanDescription: document.getElementById("selectedPlanDescription"),
      selectedPlanPrice: document.getElementById("selectedPlanPrice"),
      goPayment: document.getElementById("goPayment"),
      reviewPlans: document.getElementById("reviewPlans"),
      paymentPage: document.getElementById("paymentPage"),
      paymentPlanName: document.getElementById("paymentPlanName"),
      paymentPlanDescription: document.getElementById("paymentPlanDescription"),
      paymentPlanPrice: document.getElementById("paymentPlanPrice"),
      confirmPayment: document.getElementById("confirmPayment"),
      backToPlans: document.getElementById("backToPlans"),
      creditCard: document.getElementById("creditCard"),
      flipCardBtn: document.getElementById("flipCardBtn"),
      cardInputOverlay: document.getElementById("cardInputOverlay"),
      cardInput: document.getElementById("cardInput"),
      cardInputConfirm: document.getElementById("cardInputConfirm"),
      cardInputCancel: document.getElementById("cardInputCancel"),
      inputTitle: document.getElementById("inputTitle"),
      dashboard: document.getElementById("dashboard"),
      userName: document.getElementById("userName"),
      userEmail: document.getElementById("userEmail"),
      registrationDate: document.getElementById("registrationDate"),
      userPlanName: document.getElementById("userPlanName"),
      userPlanDescription: document.getElementById("userPlanDescription"),
      daysRemaining: document.getElementById("daysRemaining"),
      planExpiryDate: document.getElementById("planExpiryDate"),
      renewPlan: document.getElementById("renewPlan"),
      changePlan: document.getElementById("changePlan"),
      logoutBtn: document.getElementById("logoutBtn"),
      togglePassword: document.getElementById("togglePassword"),
      toggleConfirmPassword: document.getElementById("toggleConfirmPassword"),
      passwordInput: document.getElementById("password"),
      confirmPasswordInput: document.getElementById("confirmPassword")
  };

  // --- VALIDAZIONE FORM ---
  function validateForm() {
      let isValid = true;
      
      document.querySelectorAll('.error-message').forEach(el => {
          el.style.display = 'none';
          el.textContent = '';
      });
      
      const firstname = document.getElementById('firstname').value.trim();
      if (!firstname) {
          document.getElementById('firstnameError').textContent = 'Il nome è obbligatorio';
          document.getElementById('firstnameError').style.display = 'block';
          isValid = false;
      }
      
      const lastname = document.getElementById('lastname').value.trim();
      if (!lastname) {
          document.getElementById('lastnameError').textContent = 'Il cognome è obbligatorio';
          document.getElementById('lastnameError').style.display = 'block';
          isValid = false;
      }
      
      const email = document.getElementById('email').value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email) {
          document.getElementById('emailError').textContent = 'L\'email è obbligatoria';
          document.getElementById('emailError').style.display = 'block';
          isValid = false;
      } else if (!emailRegex.test(email)) {
          document.getElementById('emailError').textContent = 'Inserisci un\'email valida';
          document.getElementById('emailError').style.display = 'block';
          isValid = false;
      }
      
      const password = document.getElementById('password').value;
      if (!password) {
          document.getElementById('passwordError').textContent = 'La password è obbligatoria';
          document.getElementById('passwordError').style.display = 'block';
          isValid = false;
      } else if (password.length < 6) {
          document.getElementById('passwordError').textContent = 'La password deve essere di almeno 6 caratteri';
          document.getElementById('passwordError').style.display = 'block';
          isValid = false;
      }
      
      const confirmPassword = document.getElementById('confirmPassword').value;
      if (!confirmPassword) {
          document.getElementById('confirmPasswordError').textContent = 'Conferma la password';
          document.getElementById('confirmPasswordError').style.display = 'block';
          isValid = false;
      } else if (password !== confirmPassword) {
          document.getElementById('confirmPasswordError').textContent = 'Le password non coincidono';
          document.getElementById('confirmPasswordError').style.display = 'block';
          isValid = false;
      }
      
      return isValid;
  }

  // ✅ GESTIONE SUBMIT FORM CORRETTA
  elements.form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (validateForm()) {
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Verifica...';
        submitBtn.disabled = true;
        
        try {
            // Salva i dati dell'utente temporaneamente
            userData = {
                firstname: document.getElementById('firstname').value.trim(),
                lastname: document.getElementById('lastname').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                registrationDate: new Date().toLocaleDateString('it-IT')
            };
            
            // ✅ MOSTRA SUBITO LA SEZIONE PIANI
            elements.formSection.style.display = 'none';
            elements.plansSection.style.display = 'flex';
            
            // Salva i dati temporanei
            localStorage.setItem('tempUserData', JSON.stringify(userData));
            console.log("✅ Dati salvati, mostra sezione piani");
            
        } catch (error) {
            console.error("❌ Errore:", error);
            alert("Errore: " + error.message);
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }
  });

  // --- FUNZIONI PER IL FORM ---
  elements.togglePassword.addEventListener("click", () => {
      const type = elements.passwordInput.getAttribute("type") === "password" ? "text" : "password";
      elements.passwordInput.setAttribute("type", type);
      elements.togglePassword.textContent = type === "password" ? "Mostra" : "Nascondi";
  });

  elements.toggleConfirmPassword.addEventListener("click", () => {
      const type = elements.confirmPasswordInput.getAttribute("type") === "password" ? "text" : "password";
      elements.confirmPasswordInput.setAttribute("type", type);
      elements.toggleConfirmPassword.textContent = type === "password" ? "Mostra" : "Nascondi";
  });

  // ✅ FUNZIONE COMPLETA PER SELEZIONE PIANI E REGISTRAZIONE
  elements.chooseButtons.forEach(btn => {
    btn.addEventListener("click", async function() {
        const planDiv = this.parentElement;
        const planName = planDiv.getAttribute("data-plan");
        const planDescription = planDiv.getAttribute("data-description");
        const planPrice = planDiv.getAttribute("data-price");
        
        // Recupera i dati utente temporanei
        const tempUserData = JSON.parse(localStorage.getItem('tempUserData'));
        
        if (!tempUserData) {
            alert("Completa prima la registrazione!");
            return;
        }
        
        const chooseBtn = this;
        const originalText = chooseBtn.textContent;
        chooseBtn.textContent = 'Registrando...';
        chooseBtn.disabled = true;
        
        try {
            console.log("🚀 Iniziando registrazione per:", tempUserData.email);
            
            // 1. REGISTRA L'UTENTE IN FIREBASE AUTH
            const userCredential = await auth.createUserWithEmailAndPassword(
                tempUserData.email, 
                tempUserData.password
            );
            
            const user = userCredential.user;
            console.log("✅ Utente Firebase creato:", user.uid);
            
            // 2. SALVA DATI IN FIRESTORE
            const userDoc = {
                firstname: tempUserData.firstname,
                lastname: tempUserData.lastname,
                email: tempUserData.email,
                registrationDate: firebase.firestore.FieldValue.serverTimestamp(),
                plan: {
                    name: planName,
                    description: planDescription,
                    price: planPrice,
                    startDate: firebase.firestore.FieldValue.serverTimestamp(),
                    expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
                }
            };
            
            await db.collection("users").doc(user.uid).set(userDoc);
            console.log("✅ Dati salvati in Firestore");

            // 3. ✅ SALVA I DATI COMPLETI NEL LOCALSTORAGE
            const completeUserData = {
                uid: user.uid,
                firstname: tempUserData.firstname,
                lastname: tempUserData.lastname,
                email: tempUserData.email,
                registrationDate: tempUserData.registrationDate,
                plan: {
                    name: planName,
                    description: planDescription,
                    price: planPrice,
                    startDate: new Date(),
                    expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
                }
            };
            
            localStorage.setItem('userData', JSON.stringify(completeUserData));
            console.log("✅ Dati salvati nel localStorage");

            // 4. AGGIORNA INTERFACCIA VISIVA
            if (currentSelectedPlan) {
                currentSelectedPlan.classList.remove("selected");
                currentSelectedPlan.querySelector(".choosePlan").style.display = "block";
                currentSelectedPlan.querySelector(".choosePlan").disabled = false;
            }
            
            currentSelectedPlan = planDiv;
            planDiv.classList.add("selected");
            chooseBtn.style.display = "none";
            
            // Aggiorna il piano selezionato
            elements.selectedPlanName.textContent = planName;
            elements.selectedPlanDescription.textContent = planDescription;
            elements.selectedPlanPrice.textContent = planPrice;
            
            // Mostra sezione piano selezionato
            elements.selectedPlanContainer.style.display = "flex";
            elements.plansContainer.style.display = "none";
            
            elements.goPayment.style.display = "block";
            elements.reviewPlans.style.display = "block";
            
            // Aggiorna userData globale
            userData = completeUserData;
            
            // Pulisci dati temporanei
            localStorage.removeItem('tempUserData');
            
            console.log("✅ Registrazione completata! Utente pronto per il pagamento.");
            
        } catch (error) {
            console.error("❌ Errore registrazione:", error);
            let errorMessage = "Errore durante la registrazione: ";
            
            switch(error.code) {
                case 'auth/email-already-in-use':
                    errorMessage = "❌ Email già registrata. Usa un'altra email o accedi con il tuo account.";
                    break;
                case 'auth/invalid-email':
                    errorMessage = "❌ Email non valida";
                    break;
                case 'auth/weak-password':
                    errorMessage = "❌ Password troppo debole (minimo 6 caratteri)";
                    break;
                case 'auth/network-request-failed':
                    errorMessage = "❌ Errore di connessione. Controlla la tua internet.";
                    break;
                default:
                    errorMessage = "❌ " + error.message;
            }
            
            alert(errorMessage);
            chooseBtn.textContent = originalText;
            chooseBtn.disabled = false;
        }
    });
  });

  // ✅ FUNZIONE PER VAI AL PAGAMENTO
  elements.goPayment.addEventListener("click", () => {
      if (!currentSelectedPlan) {
          alert("Seleziona un piano prima di procedere al pagamento!");
          return;
      }
      
      // Aggiorna i dettagli del pagamento
      elements.paymentPlanName.textContent = currentSelectedPlan.getAttribute("data-plan");
      elements.paymentPlanDescription.textContent = currentSelectedPlan.getAttribute("data-description");
      elements.paymentPlanPrice.textContent = currentSelectedPlan.getAttribute("data-price");
      
      // Nascondi tutto e mostra pagamento
      elements.mainContainer.style.display = "none";
      elements.paymentPage.style.display = "block";
      
      console.log("🚀 Procedendo al pagamento per il piano:", currentSelectedPlan.getAttribute("data-plan"));
  });

  elements.reviewPlans.addEventListener("click", () => {
      elements.selectedPlanContainer.style.display = "none";
      elements.plansContainer.style.display = "grid";
      
      document.querySelectorAll(".plan").forEach(p => {
          p.querySelector(".choosePlan").style.display = "block";
          p.classList.remove("selected");
      });
      
      elements.goPayment.style.display = "none";
      elements.reviewPlans.style.display = "none";
      currentSelectedPlan = null;
  });

  elements.backToPlans.addEventListener("click", () => {
      elements.paymentPage.style.display = "none";
      elements.mainContainer.style.display = "flex";
      elements.creditCard.classList.remove("flipped");
  });

  // Gira la carta
  elements.flipCardBtn.addEventListener("click", () => {
      elements.creditCard.classList.toggle("flipped");
  });

  // --- FUNZIONI PER LA CARTA DI CREDITO ---
  document.querySelectorAll('[data-field]').forEach(field => {
      field.addEventListener('click', (e) => {
          const fieldType = e.currentTarget.getAttribute('data-field');
          openCardInput(fieldType);
      });
  });

  function openCardInput(fieldType) {
      currentEditingField = fieldType;
      
      switch(fieldType) {
          case 'card-number':
              elements.inputTitle.textContent = 'Inserisci Numero Carta';
              elements.cardInput.placeholder = '1234 5678 9012 3456';
              elements.cardInput.maxLength = 19;
              elements.cardInput.value = document.getElementById('card-number-display').textContent.replace(/•/g, '').trim();
              break;
          case 'card-holder':
              elements.inputTitle.textContent = 'Inserisci Nome Titolare';
              elements.cardInput.placeholder = 'MARIO ROSSI';
              elements.cardInput.maxLength = 30;
              elements.cardInput.value = document.getElementById('card-holder-display').textContent;
              break;
          case 'expiry-date':
              elements.inputTitle.textContent = 'Inserisci Data Scadenza (MM/AA)';
              elements.cardInput.placeholder = 'MM/AA';
              elements.cardInput.maxLength = 5;
              elements.cardInput.value = document.getElementById('expiry-date-display').textContent;
              break;
          case 'cvv':
              elements.inputTitle.textContent = 'Inserisci CVV';
              elements.cardInput.placeholder = '123';
              elements.cardInput.maxLength = 3;
              elements.cardInput.type = 'password';
              elements.cardInput.value = document.getElementById('cvv-display').textContent;
              elements.creditCard.classList.add('flipped');
              break;
      }
      
      elements.cardInputOverlay.style.display = 'flex';
      elements.cardInput.focus();
  }

  elements.cardInputConfirm.addEventListener('click', () => {
      const value = elements.cardInput.value.trim();
      
      if (value) {
          switch(currentEditingField) {
              case 'card-number':
                  let cardNumber = value.replace(/\D/g, '').slice(0, 16);
                  document.getElementById('card-number-display').textContent = formatCardNumber(cardNumber);
                  break;
              case 'card-holder':
                  document.getElementById('card-holder-display').textContent = value.toUpperCase();
                  break;
              case 'expiry-date':
                  let formattedExpiry = formatExpiryDate(value);
                  document.getElementById('expiry-date-display').textContent = formattedExpiry;
                  break;
              case 'cvv':
                  let cvv = value.replace(/\D/g, '').slice(0, 3);
                  document.getElementById('cvv-display').textContent = cvv;
                  break;
          }
      }
      
      closeCardInput();
  });

  elements.cardInputCancel.addEventListener('click', closeCardInput);

  function closeCardInput() {
      elements.cardInputOverlay.style.display = 'none';
      elements.cardInput.value = '';
      elements.cardInput.type = 'text';
      currentEditingField = null;
  }

  function formatCardNumber(number) {
      return number.replace(/\s/g, '').replace(/(\d{4})/g, '$1 ').trim().slice(0, 19);
  }

  function formatExpiryDate(value) {
      let numbers = value.replace(/\D/g, '');
      numbers = numbers.slice(0, 4);
      
      if (numbers.length >= 2) {
          return numbers.slice(0, 2) + '/' + numbers.slice(2, 4);
      }
      
      return numbers;
  }

  // ✅ FUNZIONE CONFERMA PAGAMENTO MIGLIORATA
  elements.confirmPayment.addEventListener("click", async () => {
      const cardNumber = document.getElementById('card-number-display').textContent;
      const cardHolder = document.getElementById('card-holder-display').textContent;
      const expiryDate = document.getElementById('expiry-date-display').textContent;
      const cvv = document.getElementById('cvv-display').textContent;
      
      // Validazione carta
      if (cardNumber === '•••• •••• •••• ••••' || 
          cardHolder === 'NOME COGNOME' || 
          expiryDate === 'MM/AA' || 
          cvv === '•••') {
          alert("Compila tutti i campi della carta prima di procedere!");
          return;
      }
      
      const cardNumberDigits = cardNumber.replace(/\s/g, '').replace(/•/g, '');
      if (cardNumberDigits.length !== 16) {
          alert("Il numero della carta deve essere di 16 cifre!");
          return;
      }
      
      if (cvv.length !== 3 || cvv === '•••') {
          alert("Il CVV deve essere di 3 cifre!");
          return;
      }
      
      try {
          console.log("💳 Processando pagamento...");
          
          // ✅ AGGIORNA I DATI NEL FIRESTORE CON STATO PAGAMENTO
          const user = auth.currentUser;
          if (user) {
              await db.collection("users").doc(user.uid).update({
                  paymentCompleted: true,
                  paymentDate: firebase.firestore.FieldValue.serverTimestamp(),
                  'plan.status': 'active'
              });
              
              console.log("✅ Pagamento confermato in Firestore");
          }
          
          // ✅ AGGIORNA LOCALSTORAGE
          const savedUserData = JSON.parse(localStorage.getItem('userData'));
          if (savedUserData) {
              savedUserData.paymentCompleted = true;
              savedUserData.paymentDate = new Date().toLocaleDateString('it-IT');
              savedUserData.plan.status = 'active';
              localStorage.setItem('userData', JSON.stringify(savedUserData));
          }
          
          // ✅ REINDIRIZZA ALLA DASHBOARD
          console.log("✅ Pagamento completato! Reindirizzamento alla dashboard...");
          window.location.href = 'dashboard.html';
          
      } catch (error) {
          console.error("❌ Errore durante il pagamento:", error);
          alert("Errore durante il pagamento. Riprova.");
      }
  });

  // DEBUG: Controllo stato autenticazione
  auth.onAuthStateChanged((user) => {
      if (user) {
          console.log("✅ Utente autenticato:", user.email);
          console.log("✅ UID:", user.uid);
          
          // Se l'utente è già loggato, salva i dati
          user.getIdToken().then(() => {
              console.log("✅ Token di autenticazione valido");
          });
      } else {
          console.log("❌ Nessun utente autenticato");
      }
  });

  // Inizializzazione
  document.addEventListener('DOMContentLoaded', function() {
      console.log("✅ Pagina di registrazione caricata correttamente");
      
      // Verifica se c'è un utente già loggato
      auth.onAuthStateChanged((user) => {
          if (user) {
              console.log("Utente già autenticato:", user.email);
          }
      });
  });
</script>
</body>
</html>